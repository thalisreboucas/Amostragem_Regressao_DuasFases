---
title: "Estimador do tipo Regressão para amostragem Duas Fases"
author: "Thalis Rebouças"
subtitle: "CC0292 2024 | Setembro 2024 <br><br> Slides:**thalisreboucas.github.io/Amostragem_Regressao_DuasFases/#/**"
format: 
  revealjs:
    logo: "images/logo.png"
    width: 1600
    height: 900
    self-contained: false
    incremental: false
    footer: "Slides por Thalis Rebouças, feito em [Quarto](https://quarto.org/docs/presentations/revealjs/index.html). Código disponível [no GitHub](https://github.com/thalisreboucas/Amostragem_Regressao_DuasFases)."
    theme: ["custom.scss"]
    slide-number: c/t
    show-slide-number: all
    hash-type: number
    preview-links: false
---

## Sumário de aprendizagem

Vamos explicar um pouco sobre

-   Resumo Geral

     1. Fundamentos da amostragem em Duas Fases

     2. Fundamentos de Regressão linear

     3. Fundamentos do Estimador do tipo Regressão

-   Estimador do tipo Regressão para amostragem Duas Fases

     4. Explicação e aplicações

     5. Prova dos Estimadores

-   Exemplo prático

-   Referência

# Vamos lá!

# Fundamentos da amostragem em Duas Fases

## Fundamentos da <br> amostragem em Duas Fases:

<!--# Descrito por hugo -->

- Proposto por Neymann (1938) para seleção de amostras que não temos os conhecimentos pleno de como é composta estrutural a população
- Em Särndal & Sweensson (1987) que desenvolve a teoria da amostragem em duas fases de modo teórico e induzido pelos princípios do estimador de Horvitz-Thompson.
- Em Särndal, Swensson & Wretman (1992) propós duas opções de desenhos amostras eficiêntes para a seleção da amostra.

## Fundamentos da <br> amostragem em Duas Fases:

**Desenho proposto por Särndal, Swensson & Wretman (1992)** 

-   Usar um delineamento de amostragem simples e combiná-lo com o estimador de Horvitz-Thompson.

-   Obter informações sobre a população para construir uma nova estrutura amostral, podendo utilizar o estimador de regressão para aumentar a precisão.

Nesse caso, é feita a seleção de uma amostra na primeira fase, onde são selecionados os indivíduos e coletando as variáveis auxiliares, e depois é feita uma subamostra, selecionando novamente os indivíduos e coletando as variáveis de interesse.

<!--# Resumir Foi proposto por Neymann (1938) para seleção de amostras que não temos os conhecimentos pleno de como é composta estrutural a população.e isso se reflete em uma estrutura de amostragem inadequada que não contempla variáveis de informação auxiliar (de nenhum tipo: nem discreto, nem contínuo), e por isso, não é possível propor o uso de uma estratégia de amostragem ótima (delineamentos avançados proporcionais ao tamanho ou estratificados e estimadores de regressão ou de calibração) para a estimação dos parâmetros populacionais de interesse.  01-->

## Fundamentos da <br> amostragem em Duas Fases:

**Em Resumo:** 

- Na primeira fase, selecione uma amostra relativamente grande de elementos,$s_1$,colete informações de baixo custo sobre uma ou mais variáveis auxiliares , essas variáveis auxiliares serão utilizadas para estratificar a $s_1$.

- Com o auxílio das informações auxiliares coletadas na primeira fase, selecione uma amostra de segunda fase,$s_2$, a partir de $s_1$,utilizando o delineamento $p(.|s_1)$, com isso $s_2$ uma subamostra. A variável de estudo $y$ é então observada para os elementos na amostra da segunda fase.

# Fundamentos de Regressão linear simples

## Fundamentos de <br> Regressão linear simples

- O MRLS tem a seguinte forma:
$$
 y_i = \beta_0 + \beta_1x_i + e_i , \forall_i = 1,\ldots,n.
$$
em que:
- $y_i$ é o valor da variável resposta e $x_i$ é o valor da variável explicativa, ambas referentes ao i-ésimo elemento da amostra.
- $\beta_0$ e $\beta_1$ são parâmentros desconhecidos, denominados parâmetros (coeficientes) de regressão.
- $e_i$ representa a fonte de variação associada ao i-ésimo elemento da amostra.

## Fundamentos de <br> Regressão linear simples

**Premissas**

1. A função de regressão é linear
2. $x_i$ são fixos e não são variáveis aleatórias. 
3. $E[e_i|x_i] = 0, \forall_i=1,\ldots,n.$ 
4. $Var[y_i|x_i] = Var[e_i|x_i] = \sigma^2, \forall_i=1,\ldots,n.$ (**Homoscesdaticidade**) 
5. $Cov(e_i,e_j) = E[e_ie_j] = 0, \ \forall i \neq j$
6. $e_j \sim  N(0,\sigma^2) ,i=1,\ldots,n.$ (**Para inferência de segunda ordem**)

## Fundamentos de <br> Regressão linear simples

**Estimador da Reta de regressão ajustada por MQ**

$$ \hat{y}_i = \hat{\beta}_0 +\hat{\beta}_1x_i , \ i,\ldots,n. $$

- $\hat{\beta_0} = \bar{y_n} - \hat{\beta_1}\cdot \bar{x_n}$

- $\hat{\beta_1} = \dfrac{\sum^n_{i=1} (x_i-\bar{x_n})(y_i-\bar{y_n})}{\sum^n_{i=1} (x_i-\bar{x_n})^2}$

- $\hat{e}_i = y_i-\hat{y}_i = yi - (\hat{\beta}_0 +\hat{\beta}_1x_i) , \ i,\ldots,n.$


# Fundamentos do Estimador do tipo Regressão


# Estimador do tipo Regressão para amostragem Duas Fases

## Explicação

É um método de amostragem que utiliza informações auxiliares, coletadas juntamente com a amostra principal, para melhorar a precisão das estimativas dos valores totais e suas variâncias. Essas informações auxiliares podem incluir dados que estão relacionados com a variável de interesse, mas que são mais fáceis ou mais baratos de coletar.

Assim, o método não apenas se baseia na amostra observada, mas também aproveita as informações adicionais disponíveis para fazer inferências mais precisas sobre a população inteira.

## Explicação

 O Sandal, propõem um distinção em três situações dependendo da natureza da  informação auxiliar.
 
 1. O valor de $x_k=(x_{1k,...,x_{qk})'}$ do vetor auxiliar é $x=(x_1,...,x_q)'$ é registrado para as unidades $k \in s$.
 
 2. O valor de $x_k$ está disponível para todas as unidades $k$ em toda a população $U$.
 
 3. Uma combinação das Situações 1 e 2. O valor $xk$  é registrado para $k \in s$ e alguma outra informação (talvez uma relação'mais fraca') $z_k=(z_{1k,...,z_{pk})'}$ é conhecida para todas as unidades $k in U$.

## Explicação

 **Desenvolvendo a situação 1 e 2**
De acordo com  (Cassel, Sarndal & Wretman, 1976; Särndal, 1982), temos que: 
- Supor a existência de uma relação de regressão entre $x_k$ e $y_k$ na população finita.
- $y_k$  será observado apenas em uma amostra de segunda fase relativamente pequena.(Por conta de escassez de informação).


## Explicação

Para uma amostra de tamanho $n$, temos a seguinte reta de regressão:

$$\bar{y}_{reg} = \bar{y}+ b(\bar{x}'-\bar{x})$$
Sendo $b$ o coefiente de regressão estimado de $y_i$ em $x_i$ que são calculadas na segunda amostra e temos $\bar{x}'$ é da segunda amostra e $\bar{x}$ é o da primeira amostra.

## Variancia

Para uma amostra de tamanho $n$, temos a seguinte reta de regressão:

$$\bar{y}_{reg} = \bar{y}+ b(\bar{x}'-\bar{x})$$
Sendo $b$ o coefiente de regressão estimado de $y_i$ em $x_i$ que são calculadas na segunda amostra e temos $\bar{x}'$ é da segunda amostra e $\bar{x}$ é o da primeira amostra.

## Estimadores




## Estimador de Mínimos Quadrados Ponderados

$$\beta= \left(\sum\dfrac{x_kx'_x}{\sigma^2_k}\right)^{-1}\sum\dfrac{x_ky_k}{\sigma^2_k}$$ 
$$\hat{e}_k=y_k-x_k\beta$$

# Prova dos Estimadores

# Exemplos 

## Exemplo do Livro Advanced Sampling Methods


**Exemplo 6.2 da página 81**

Selecione uma amostra de 20 unidades na primeira fase usando amostragem aleatória simples sem reposição e registre apenas a idade de uma pessoa em um bloco das unidades selecionadas na amostra. A partir da amostra da primeira fase de 20 unidades, selecione uma subamostra de 10 unidades e registre tanto a idade de uma pessoa quanto as horas de sono. Estime as horas médias de sono (anos) em um bloco usando um estimador de regressão em amostragem em duas fases. Deduzir o intervalo de confiança de 95%.

```{r}
# Idades
x <- c(45.84, 73.82, 64.49, 58.46, 73.62, 58.91, 75.70, 59.15, 78.20, 62.89,
       65.65, 64.94, 71.50, 62.92, 75.96, 74.63, 79.12, 65.80, 63.25, 70.06,
       67.10, 62.63, 72.67, 70.85, 84.86, 64.06, 70.33, 62.61, 76.42, 57.91,
       68.26, 58.82, 80.57, 77.63, 63.06, 71.14, 68.55, 84.53, 51.64, 76.62,
       64.89, 76.66, 63.50, 56.01, 70.84, 58.23, 72.68, 60.06, 68.19, 58.66)

# Número de horas de sono
y <- c(552.28, 367.02, 395.99, 477.71, 306.01, 435.09, 336.97, 359.99, 379.35, 403.77,
       366.45, 401.95, 403.39, 412.02, 309.47, 394.52, 352.69, 347.07, 388.45, 147.54,
       383.84, 400.17, 369.27, 361.34, 279.81, 421.00, 332.56, 397.37, 327.21, 425.10,
       436.99, 488.72, 280.05, 276.77, 381.98, 326.33, 383.53, 240.07, 434.50, 343.46,
       419.98, 310.65, 419.73, 454.06, 354.54, 395.14, 314.81, 425.12, 367.02, 412.70)

# Definindo a semente para reprodutibilidade
set.seed(3)

# Seleciona uma amostra de 20 unidades
s1 <- sample(1:50, 20, replace = FALSE)
X <- x[s1]
mX <- mean(X)

# Seleciona uma subamostra de 10 unidades da amostra anterior
S1 <- sample(s1, 10, replace = FALSE)
dx <- x[S1]
dy <- y[S1]

# Calcula as médias, variâncias e covariâncias
mdx <- mean(dx)
mdy <- mean(dy)
vdx <- var(dx)
vdy <- var(dy)
cdxdy <- cov(dx, dy)

# Estima o coeficiente beta da regressão
beta <- cdxdy / vdx

# Estimador de regressão para a média das horas de sono
ybrd <- mdy + beta * (mX - mdx)

# Calcula o erro quadrático médio
Mse <- ((1/20) - (1/50)) * vdy + ((1/10) - (1/20)) * vdy * (1 - cor(dx,dy)^2)

# Calcula o valor t para o intervalo de confiança de 95%
t <- qt(0.975, 9)

# Calcula os limites inferior e superior do intervalo de confiança
LL <- ybrd - t * sqrt(Mse)
UL <- ybrd + t * sqrt(Mse)

# Exibe os resultados
beta
ybrd
Mse
LL
UL


```
As horas médias de sono em um ano são 380,16 com um erro quadrático médio de 70,05, e um intervalo de confiança de 95% é [376,34, 414,21].


<!-- Estimating Lichen Biomass and Caribou Grazing on the Wintering Grounds of Northern Québec: An Application of Fire History and Landsat Data -->

## outra slide
O problema pede para realizar uma amostragem em duas fases para estimar a média de horas de sono por ano em um determinado bloco, utilizando um estimador de regressão.

Fase 1:
Amostragem Aleatória Simples Sem Reposição (SRSWOR): Selecione aleatoriamente 20 unidades (indivíduos) do bloco, sem permitir repetições. Anote apenas a idade de cada indivíduo selecionado nesta fase.

Utilização da Tabela 6.1: A tabela 6.1, mencionada no enunciado, provavelmente contém a lista completa de indivíduos no bloco e suas respectivas idades. Utilize esta tabela para selecionar aleatoriamente os 20 indivíduos da primeira fase.

Fase 2:
Subamostragem: Dos 20 indivíduos selecionados na Fase 1, selecione aleatoriamente 10 indivíduos, formando uma subamostra.
Coleta de Dados Completa: Para cada indivíduo na subamostra, anote tanto a idade quanto as horas de sono.

Estimativa e Intervalo de Confiança:
Estimador de Regressão: Utilize um estimador de regressão para estimar a média de horas de sono por ano para todo o bloco, usando as informações coletadas nas duas fases da amostragem. O estimador de regressão utiliza a relação entre idade e horas de sono observada na subamostra para melhorar a precisão da estimativa.

Intervalo de Confiança de 95%: Calcule um intervalo de confiança de 95% para a média estimada de horas de sono por ano. Este intervalo fornecerá uma faixa de valores plausíveis para a verdadeira média da população, com 95% de confiança.

Em resumo, o objetivo é estimar a média de horas de sono por ano em um bloco, utilizando um método de amostragem em duas fases com um estimador de regressão para aumentar a precisão da estimativa.


## outro slide 

$$\hat{y}_{reg}= \bar{y}+\beta(\bar{X}-\bar{x})$$
$$MSE=\left(\dfrac{1}{20}-\dfrac{1}{50}\right)v_y+\left(\dfrac{1}{10}-\dfrac{1}{20}\right)v_y(1-p^2)$$
$$IC = [\hat{y}_{reg}-t\sqrt{MSE},\hat{y}_{reg}+t\sqrt{MSE}]$$
Dados Utilizados:
Variável Auxiliar (x): Idade
Variável de Interesse (y): Número de horas de sono
Etapas de Análise:
Seleção da amostra inicial (20 unidades) por SRSWOR.
Seleção da subamostra (10 unidades) para coleta adicional de dados.
Cálculo dos estimadores de regressão.
Estimativa da média das horas de sono.
Cálculo do intervalo de confiança.



# Referências

- Särndal, Swensson & Wretman (1992). Model Assisted Survey Samplig.
- Raosaheb Latpate, Jayant Kshirsagar, Vinod Kumar Gupta, Girish Chandra (2021). Advanced Sampling Methods.
- Särndal, Swensson (1987). A General View of Estimation for Two Phases of Selection with Applications to Two-Phase Sampling and Nonresponse.
- Andrés Gutiérrez (2015). Estrategias de muestreo Diseño de encuestas y estimacion de parámetros.
- Shalabh, IIT Kanpur.Sampling Theory(https://home.iitk.ac.in/~shalab/course1.htm & https://nptel.ac.in/courses/111104073)
